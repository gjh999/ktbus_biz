<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="partnerManageDAO">


    <resultMap id="stplatMap" type="egovframework.let.uss.umt.service.StplatVO">
        <result property="useStplatId" column="USE_STPLAT_ID"/>
        <result property="useStplatCn" column="USE_STPLAT_CN"/>
        <result property="infoProvdAgeCn" column="INFO_PROVD_AGRE_CN"/>
    </resultMap>
    
 <select id="selectPartnerList" parameterType="egovframework.let.uss.umt.service.UserDefaultVO" resultType="egovMap">
	SELECT 
	    uniq_Id, user_Ty, mber_Id , user_Nm, email_Adres, area_No, middle_Telno, end_Telno, moblphon_No, group_Id, sttus, sbscrb_De
	FROM(
	    SELECT 
	        ESNTL_ID               uniq_Id,
	        'USR01'               user_Ty,
	        ENTRPRS_MBER_ID               mber_Id,
	        CMPNY_NM               user_Nm,
	        PIC_EMAIL_ADRES      email_Adres,
	        ''               area_No,
	        ''          middle_Telno,
	        ''             end_Telno,
	        PIC_MOBLPHON_NO           moblphon_No,
	        GROUP_ID              group_Id,
	        ENTRPRS_MBER_STTUS            sttus,
	        VARCHAR_FORMAT(SBSCRB_DE,'YYYY-MM-DD') sbscrb_De
	    FROM    LETTNENTRPRSMBER
	    ) A
        WHERE 1=1
        <if test='sbscrbSttus != "0"'>
            AND sttus LIKE  #{sbscrbSttus}
        </if>
        <if test='searchCondition == "0"'>
            AND mber_Id LIKE '${searchKeyword}'
        </if>
        <if test='searchCondition == "1"'>
            AND user_Nm LIKE '%' || '${searchKeyword}' || '%'
        </if>
        ORDER BY sbscrb_De DESC
        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>
    
    
        <select id="selectPartnerListTotCnt" parameterType="egovframework.let.uss.umt.service.UserDefaultVO" resultType="int">
        SELECT COUNT(1) totcnt
        FROM(
            SELECT 
	        ESNTL_ID               uniq_Id,
	        'USR01'               user_Ty,
	        ENTRPRS_MBER_ID               mber_Id,
	        CMPNY_NM               user_Nm,
	        PIC_EMAIL_ADRES      email_Adres,
	        ''               area_No,
	        ''          middle_Telno,
	        ''             end_Telno,
	        PIC_MOBLPHON_NO           moblphon_No,
	        GROUP_ID              group_Id,
	        ENTRPRS_MBER_STTUS            sttus,
	        VARCHAR_FORMAT(SBSCRB_DE,'YYYY-MM-DD') sbscrb_De
	    FROM    LETTNENTRPRSMBER
	    ) A
        WHERE 1=1
            <if test='sbscrbSttus != "0"'>
                AND sttus LIKE  #{sbscrbSttus}
            </if>
            <if test='searchCondition == "0"'>
                AND mber_Id LIKE '${searchKeyword}'
            </if>
            <if test='searchCondition == "1"'>
                AND user_Nm LIKE '%' || '${searchKeyword}' || '%'
            </if>
    </select>
    
    <insert id="insertPartner_S">
        
            INSERT INTO LETTNENTRPRSMBER (
			  ENTRPRS_MBER_ID
			, ENTRPRS_SE_CODE
			, BIZRNO
			, JURIRNO
			, CMPNY_NM
			, CXFC
			, ZIP
			, ADRES
			, ENTRPRS_MIDDLE_TELNO
			, FXNUM
			, INDUTY_CODE
			, APPLCNT_NM
			, APPLCNT_IHIDNUM
			, SBSCRB_DE
			, ENTRPRS_MBER_STTUS
			, ENTRPRS_MBER_PASSWORD
			, ENTRPRS_MBER_PASSWORD_HINT
			, ENTRPRS_MBER_PASSWORD_CNSR
			, GROUP_ID
			, DETAIL_ADRES
			, ENTRPRS_END_TELNO
			, AREA_NO
			, APPLCNT_EMAIL_ADRES
			, ESNTL_ID
			) VALUES (
			 #{entrprsPartnerId}
			 , 'ENT'
			 , #{bizNo} 
			 , #{corpNo1}
			 , #{partnerNm}
			 , ''
			 , #{zip}
			 , #{adres}
			 , ''
			 , #{offmFaxno}
			 , ''
			 , #{picNm}
			 , ''
			 , NOW()
			 , 'A'
			 , #{password}
			 , #{passwordHint}
			 , #{passwordCnsr}
			 , #{groupId}
			 , #{detailAdres}
			 , ''
			 , ''
			 , #{picEmailAdres}
			 , #{uniqId}
			)
             
        
    </insert>
    
    <delete id="deletePartner_S">
        
            DELETE FROM LETTNGNRLMBER 
            WHERE ESNTL_ID=#{delId}
        
    </delete>
    
    <select id="selectPartner_S" resultType="egovframework.let.uss.umt.service.PartnerManageVO">
        
            SELECT
                ESNTL_ID          uniq_Id,
                'USR01'          user_Ty,
                ENTRPRS_MBER_ID          mber_Id,
                CMPNY_NM          mber_Nm,
                PASSWORD         password,
                ENTRPRS_MBER_PASSWORD_HINT    password_Hint,
                ENTRPRS_MBER_PASSWORD_CNSR    password_Cnsr,
                ''          ihidnum,
                ''     sexdstn_Code,
                ZIP              zip,
                ADRES            adres,
                ''          area_No,
                ENTRPRS_MBER_STTUS       mber_Sttus,
                DETAIL_ADRES     detail_Adres,
                ''        end_Telno,
                CEO_MOBLPHON_NO      moblphon_No,
                GROUP_ID         group_Id,
                FXNUM       mber_Fxnum,
                PIC_EMAIL_ADRES mber_Email_Adres,
                ''     middle_Telno,
                VARCHAR_FORMAT(SBSCRB_DE,'YYYY-MM-DD') sbscrb_De
            FROM LETTNENTRPRSMBER
            WHERE ESNTL_ID=#{uniqId}
        
    </select>
    
    <update id="updatePartner_S">
        
            UPDATE LETTNGNRLMBER 
            SET MBER_ID          = #{mberId},
                MBER_NM          = #{mberNm},
                PASSWORD_HINT    = #{passwordHint},
                PASSWORD_CNSR    = #{passwordCnsr},
                IHIDNUM          = #{ihidnum},
                SEXDSTN_CODE     = #{sexdstnCode},
                ZIP              = #{zip},
                ADRES            = #{adres},
                AREA_NO          = #{areaNo},
                MBER_STTUS       = #{mberSttus},
                DETAIL_ADRES     = #{detailAdres},
                END_TELNO        = #{endTelno},
                MBTLNUM      = #{moblphonNo},
                GROUP_ID         = #{groupId},
                MBER_FXNUM       = #{mberFxnum},
                MBER_EMAIL_ADRES = #{mberEmailAdres},
                MIDDLE_TELNO     = #{middleTelno}
            WHERE ESNTL_ID=#{uniqId}
        
    </update>
    
    <select id="selectStplat_S" resultMap="stplatMap">
        
            SELECT
                USE_STPLAT_ID           ,
                USE_STPLAT_CN           ,
                INFO_PROVD_AGRE_CN      
            FROM LETTNSTPLATINFO
            WHERE USE_STPLAT_ID=#{stplatId}
        
    </select>
    
    <update id="updatePassword_S">
        
            UPDATE LETTNGNRLMBER 
            SET 
                   PASSWORD   =  #{password}
            WHERE  ESNTL_ID  = #{uniqId}
        
    </update>
    
    <select id="selectPassword_S" resultType="egovframework.let.uss.umt.service.PartnerManageVO">
        
            SELECT
                    PASSWORD          password 
            FROM    LETTNGNRLMBER
            WHERE   ESNTL_ID=#{uniqId}
        
    </select>
    
    <select id="checkIdDplct_S" resultType="int">
     
         SELECT COUNT(1) usedCnt
             FROM(
             SELECT
                 EMPLYR_ID             mberId
             FROM    LETTNEMPLYRINFO
             UNION ALL
             SELECT
                 ENTRPRS_MBER_ID        mberId
             FROM    LETTNENTRPRSMBER
             UNION ALL
             SELECT
                 MBER_ID               mberId
             FROM    LETTNGNRLMBER
             ) A
         WHERE mberId = #{checkId}
     
    </select>
</mapper>