<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="totAbstractDAO">



	<select id="tot01List" parameterType="java.util.Map"
		resultType="Map">
		
	SELECT
         3 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , HKMYER||'년' AS HKMYER
          ,'경과분담금' AS TITLE
         ,SUM(HIKKM0) AS HIKKM0 
         ,SUM(HIKKM1) AS HIKKM1
         ,SUM(HIKKM2) AS HIKKM2
         ,SUM(HIKKM3) AS HIKKM3
         ,SUM(HIKKM4) AS HIKKM4
         ,SUM(HIKKM5) AS HIKKM5
         ,SUM(HIKKM6) AS HIKKM6
         ,SUM(HIKKM7) AS HIKKM7
         ,SUM(HIKKM8) AS HIKKM8
         ,SUM(HIKKM9) AS HIKKM9
         ,SUM(HIKKM10) AS HIKKM10
         ,SUM(HIKKM11) AS HIKKM11
         ,SUM(HIKKM12) AS HIKKM12
      FROM (
         SELECT
              DIGITS(HKMYER) AS HKMYER
            , DIGITS(HKMMON) AS HKMMON
            , TRIM(B.CBCNM1) AS CBCNM1
            , SUM(HKGKM) AS HIKKM0
            , CASE WHEN HKMMON=1 THEN SUM(HKGKM) ELSE 0 END AS HIKKM1
            , CASE WHEN HKMMON=2 THEN SUM(HKGKM) ELSE 0 END AS HIKKM2
            , CASE WHEN HKMMON=3 THEN SUM(HKGKM) ELSE 0 END AS HIKKM3
            , CASE WHEN HKMMON=4 THEN SUM(HKGKM) ELSE 0 END AS HIKKM4
            , CASE WHEN HKMMON=5 THEN SUM(HKGKM) ELSE 0 END AS HIKKM5
            , CASE WHEN HKMMON=6 THEN SUM(HKGKM) ELSE 0 END AS HIKKM6
            , CASE WHEN HKMMON=7 THEN SUM(HKGKM) ELSE 0 END AS HIKKM7
            , CASE WHEN HKMMON=8 THEN SUM(HKGKM) ELSE 0 END AS HIKKM8
            , CASE WHEN HKMMON=9 THEN SUM(HKGKM) ELSE 0 END AS HIKKM9
            , CASE WHEN HKMMON=10 THEN SUM(HKGKM) ELSE 0 END AS HIKKM10
            , CASE WHEN HKMMON=11 THEN SUM(HKGKM) ELSE 0 END AS HIKKM11
            , CASE WHEN HKMMON=12 THEN SUM(HKGKM) ELSE 0 END AS HIKKM12
         FROM MAADBF.HM5100 A, STDDBF.COD100 B
         WHERE
                HKMYER=${FYY}
            AND HKCBSD||HKCBSQ =#{JOCODE}
            AND A.HKCBSD=B.CBSIDO AND A.HKCBSQ=DIGITS(B.CBSEQN) 
            AND HKDMGB NOT IN ('6','7')
         GROUP BY HKMYER, HKMMON , CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR='${FYY}'
      GROUP BY HKMYER, A.CBCNM1


      UNION ALL
      --조합원별 손해금액
      SELECT
         4 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , A.RSMYER||'년' AS RSMYER
         , '손해금액' AS TITLE
         ,SUM(RSOKKM0)-SUM(RSIWKM)+MAX(RSMGKM) AS RSOKKM0 --당월결정금액-전월미결추산(1월마감의 전월미결추산)+차기미결추산(마지막월의 차기미결추산)
         ,SUM(RSOKKM1) AS RSOKKM1
         ,SUM(RSOKKM2) AS RSOKKM2
         ,SUM(RSOKKM3) AS RSOKKM3
         ,SUM(RSOKKM4) AS RSOKKM4
         ,SUM(RSOKKM5) AS RSOKKM5
         ,SUM(RSOKKM6) AS RSOKKM6
         ,SUM(RSOKKM7) AS RSOKKM7
         ,SUM(RSOKKM8) AS RSOKKM8
         ,SUM(RSOKKM9) AS RSOKKM9
         ,SUM(RSOKKM10) AS RSOKKM10
         ,SUM(RSOKKM11) AS RSOKKM11
         ,SUM(RSOKKM12) AS RSOKKM12
      FROM (
         SELECT
           DIGITS(RSMYER) AS RSMYER
         , DIGITS(RSMMON) AS RSMMON
         , TRIM(B.CBCNM1) AS CBCNM1
         , SUM(RSOKKM) AS RSOKKM0 
         , CASE WHEN RSMMON=1  THEN SUM(RSIWKM) ELSE 0 END AS RSIWKM --1월의 전월미결추산
         , CASE WHEN RSMMON=1 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM1
         , CASE WHEN RSMMON=2 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM2
         , CASE WHEN RSMMON=3 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM3
         , CASE WHEN RSMMON=4 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM4
         , CASE WHEN RSMMON=5 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM5
         , CASE WHEN RSMMON=6 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM6
         , CASE WHEN RSMMON=7 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM7
         , CASE WHEN RSMMON=8 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM8
         , CASE WHEN RSMMON=9 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM9
         , CASE WHEN RSMMON=10 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM10
         , CASE WHEN RSMMON=11 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM11
         , CASE WHEN RSMMON=12 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM12
      FROM MAADBF.HM6100 A, STDDBF.COD100 B
      WHERE
             RSMYER=${FYY}
         AND RSCBSD||RSCBSQ =#{JOCODE}
         AND A.RSCBSD||A.RSCBSQ =B.CBSIDO||DIGITS(B.CBSEQN)
      GROUP BY RSMYER, RSMMON, CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR='${FYY}'
     LEFT OUTER JOIN(
         SELECT RSCBSD||RSCBSQ AS CBCOD, DIGITS(RSMYER) AS RSMYER ,RSMMON,  SUM(RSMGKM) AS RSMGKM
         FROM MAADBF.HM6100 A
         WHERE
            RSMYER=${FYY}
         AND RSCBSD||RSCBSQ =#{JOCODE}
         GROUP BY RSCBSD||RSCBSQ , RSMYER,RSMMON
         ORDER BY 1,2,3 DESC,4 DESC
         FETCH FIRST 1 ROWS ONLY
     ) G1 ON A.RSMYER=G1.RSMYER AND G1.CBCOD=#{JOCODE}

      GROUP BY A.RSMYER, CBCNM1
    UNION ALL 
   --조회년도 -1
   SELECT
         5 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , HKMYER||'년' AS HKMYER
         , '경과분담금' AS TITLE
         ,SUM(HIKKM0) AS HIKKM0 
         ,SUM(HIKKM1) AS HIKKM1
         ,SUM(HIKKM2) AS HIKKM2
         ,SUM(HIKKM3) AS HIKKM3
         ,SUM(HIKKM4) AS HIKKM4
         ,SUM(HIKKM5) AS HIKKM5
         ,SUM(HIKKM6) AS HIKKM6
         ,SUM(HIKKM7) AS HIKKM7
         ,SUM(HIKKM8) AS HIKKM8
         ,SUM(HIKKM9) AS HIKKM9
         ,SUM(HIKKM10) AS HIKKM10
         ,SUM(HIKKM11) AS HIKKM11
         ,SUM(HIKKM12) AS HIKKM12
      FROM (
         SELECT
              DIGITS(HKMYER) AS HKMYER
            , DIGITS(HKMMON) AS HKMMON
            , TRIM(B.CBCNM1) AS CBCNM1
            , SUM(HKGKM) AS HIKKM0
            , CASE WHEN HKMMON=1 THEN SUM(HKGKM) ELSE 0 END AS HIKKM1
            , CASE WHEN HKMMON=2 THEN SUM(HKGKM) ELSE 0 END AS HIKKM2
            , CASE WHEN HKMMON=3 THEN SUM(HKGKM) ELSE 0 END AS HIKKM3
            , CASE WHEN HKMMON=4 THEN SUM(HKGKM) ELSE 0 END AS HIKKM4
            , CASE WHEN HKMMON=5 THEN SUM(HKGKM) ELSE 0 END AS HIKKM5
            , CASE WHEN HKMMON=6 THEN SUM(HKGKM) ELSE 0 END AS HIKKM6
            , CASE WHEN HKMMON=7 THEN SUM(HKGKM) ELSE 0 END AS HIKKM7
            , CASE WHEN HKMMON=8 THEN SUM(HKGKM) ELSE 0 END AS HIKKM8
            , CASE WHEN HKMMON=9 THEN SUM(HKGKM) ELSE 0 END AS HIKKM9
            , CASE WHEN HKMMON=10 THEN SUM(HKGKM) ELSE 0 END AS HIKKM10
            , CASE WHEN HKMMON=11 THEN SUM(HKGKM) ELSE 0 END AS HIKKM11
            , CASE WHEN HKMMON=12 THEN SUM(HKGKM) ELSE 0 END AS HIKKM12
         FROM MAADBF.HM5100 A, STDDBF.COD100 B
         WHERE
                HKMYER=${FYY}-1
            AND HKCBSD||HKCBSQ =#{JOCODE}
            AND A.HKCBSD=B.CBSIDO AND A.HKCBSQ=DIGITS(B.CBSEQN) 
            AND HKDMGB NOT IN ('6','7')
         GROUP BY HKMYER, HKMMON , CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR=CHAR(INT('${FYY}'-1)) 

      GROUP BY HKMYER, A.CBCNM1


      UNION ALL
      --조합원별 손해금액
      SELECT
         6 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , RSMYER||'년' AS RSMYER
         , '손해금액' AS TITLE
         ,SUM(RSOKKM0)-SUM(RSIWKM)+SUM(RSMGKM) AS RSOKKM0 --당월결정금액-전월미결추산(1월마감의 전월미결추산)+차기미결추산(12월의 차기미결추산)
         ,SUM(RSOKKM1) AS RSOKKM1
         ,SUM(RSOKKM2) AS RSOKKM2
         ,SUM(RSOKKM3) AS RSOKKM3
         ,SUM(RSOKKM4) AS RSOKKM4
         ,SUM(RSOKKM5) AS RSOKKM5
         ,SUM(RSOKKM6) AS RSOKKM6
         ,SUM(RSOKKM7) AS RSOKKM7
         ,SUM(RSOKKM8) AS RSOKKM8
         ,SUM(RSOKKM9) AS RSOKKM9
         ,SUM(RSOKKM10) AS RSOKKM10
         ,SUM(RSOKKM11) AS RSOKKM11
         ,SUM(RSOKKM12) AS RSOKKM12
      FROM (
         SELECT
           DIGITS(RSMYER) AS RSMYER
         , DIGITS(RSMMON) AS RSMMON
         , TRIM(B.CBCNM1) AS CBCNM1
         , SUM(RSOKKM) AS RSOKKM0 
         , CASE WHEN RSMMON=1  THEN SUM(RSIWKM) ELSE 0 END AS RSIWKM --1월의 전월미결추산
         , CASE WHEN RSMMON=12 THEN SUM(RSMGKM) ELSE 0 END AS RSMGKM --12월의 차기미결추산
         , CASE WHEN RSMMON=1 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM1
         , CASE WHEN RSMMON=2 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM2
         , CASE WHEN RSMMON=3 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM3
         , CASE WHEN RSMMON=4 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM4
         , CASE WHEN RSMMON=5 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM5
         , CASE WHEN RSMMON=6 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM6
         , CASE WHEN RSMMON=7 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM7
         , CASE WHEN RSMMON=8 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM8
         , CASE WHEN RSMMON=9 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM9
         , CASE WHEN RSMMON=10 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM10
         , CASE WHEN RSMMON=11 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM11
         , CASE WHEN RSMMON=12 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM12

      FROM MAADBF.HM6100 A, STDDBF.COD100 B
      WHERE
             RSMYER=${FYY}-1
         AND RSCBSD||RSCBSQ =#{JOCODE}
         AND A.RSCBSD||A.RSCBSQ =B.CBSIDO||DIGITS(B.CBSEQN)
      GROUP BY RSMYER, RSMMON, CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR=CHAR(INT('${FYY}'-1)) 
      GROUP BY RSMYER, CBCNM1
    UNION ALL 
   --조회년도 -2
   SELECT
         7 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , HKMYER||'년' AS HKMYER
         , '경과분담금' AS TITLE
         ,SUM(HIKKM0) AS HIKKM0 
         ,SUM(HIKKM1) AS HIKKM1
         ,SUM(HIKKM2) AS HIKKM2
         ,SUM(HIKKM3) AS HIKKM3
         ,SUM(HIKKM4) AS HIKKM4
         ,SUM(HIKKM5) AS HIKKM5
         ,SUM(HIKKM6) AS HIKKM6
         ,SUM(HIKKM7) AS HIKKM7
         ,SUM(HIKKM8) AS HIKKM8
         ,SUM(HIKKM9) AS HIKKM9
         ,SUM(HIKKM10) AS HIKKM10
         ,SUM(HIKKM11) AS HIKKM11
         ,SUM(HIKKM12) AS HIKKM12
      FROM (
         SELECT
              DIGITS(HKMYER) AS HKMYER
            , DIGITS(HKMMON) AS HKMMON
            , TRIM(B.CBCNM1) AS CBCNM1
            , SUM(HKGKM) AS HIKKM0
            , CASE WHEN HKMMON=1 THEN SUM(HKGKM) ELSE 0 END AS HIKKM1
            , CASE WHEN HKMMON=2 THEN SUM(HKGKM) ELSE 0 END AS HIKKM2
            , CASE WHEN HKMMON=3 THEN SUM(HKGKM) ELSE 0 END AS HIKKM3
            , CASE WHEN HKMMON=4 THEN SUM(HKGKM) ELSE 0 END AS HIKKM4
            , CASE WHEN HKMMON=5 THEN SUM(HKGKM) ELSE 0 END AS HIKKM5
            , CASE WHEN HKMMON=6 THEN SUM(HKGKM) ELSE 0 END AS HIKKM6
            , CASE WHEN HKMMON=7 THEN SUM(HKGKM) ELSE 0 END AS HIKKM7
            , CASE WHEN HKMMON=8 THEN SUM(HKGKM) ELSE 0 END AS HIKKM8
            , CASE WHEN HKMMON=9 THEN SUM(HKGKM) ELSE 0 END AS HIKKM9
            , CASE WHEN HKMMON=10 THEN SUM(HKGKM) ELSE 0 END AS HIKKM10
            , CASE WHEN HKMMON=11 THEN SUM(HKGKM) ELSE 0 END AS HIKKM11
            , CASE WHEN HKMMON=12 THEN SUM(HKGKM) ELSE 0 END AS HIKKM12
         FROM MAADBF.HM5100 A, STDDBF.COD100 B
         WHERE
                HKMYER=${FYY}-2
            AND HKCBSD||HKCBSQ =#{JOCODE}
            AND A.HKCBSD=B.CBSIDO AND A.HKCBSQ=DIGITS(B.CBSEQN) 
            AND HKDMGB NOT IN ('6','7')
         GROUP BY HKMYER, HKMMON , CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR=CHAR(INT('${FYY}'-2)) 
      GROUP BY HKMYER, A.CBCNM1


      UNION ALL
      --조합원별 손해금액
      SELECT
         8 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , RSMYER||'년' AS RSMYER
         , '손해금액' AS TITLE
         ,SUM(RSOKKM0)-SUM(RSIWKM)+SUM(RSMGKM) AS RSOKKM0 --당월결정금액-전월미결추산(1월마감의 전월미결추산)+차기미결추산(12월의 차기미결추산)
         ,SUM(RSOKKM1) AS RSOKKM1
         ,SUM(RSOKKM2) AS RSOKKM2
         ,SUM(RSOKKM3) AS RSOKKM3
         ,SUM(RSOKKM4) AS RSOKKM4
         ,SUM(RSOKKM5) AS RSOKKM5
         ,SUM(RSOKKM6) AS RSOKKM6
         ,SUM(RSOKKM7) AS RSOKKM7
         ,SUM(RSOKKM8) AS RSOKKM8
         ,SUM(RSOKKM9) AS RSOKKM9
         ,SUM(RSOKKM10) AS RSOKKM10
         ,SUM(RSOKKM11) AS RSOKKM11
         ,SUM(RSOKKM12) AS RSOKKM12
      FROM (
         SELECT
           DIGITS(RSMYER) AS RSMYER
         , DIGITS(RSMMON) AS RSMMON
         , TRIM(B.CBCNM1) AS CBCNM1
         , SUM(RSOKKM) AS RSOKKM0 
         , CASE WHEN RSMMON=1  THEN SUM(RSIWKM) ELSE 0 END AS RSIWKM --1월의 전월미결추산
         , CASE WHEN RSMMON=12 THEN SUM(RSMGKM) ELSE 0 END AS RSMGKM --12월의 차기미결추산
         , CASE WHEN RSMMON=1 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM1
         , CASE WHEN RSMMON=2 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM2
         , CASE WHEN RSMMON=3 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM3
         , CASE WHEN RSMMON=4 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM4
         , CASE WHEN RSMMON=5 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM5
         , CASE WHEN RSMMON=6 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM6
         , CASE WHEN RSMMON=7 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM7
         , CASE WHEN RSMMON=8 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM8
         , CASE WHEN RSMMON=9 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM9
         , CASE WHEN RSMMON=10 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM10
         , CASE WHEN RSMMON=11 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM11
         , CASE WHEN RSMMON=12 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM12

      FROM MAADBF.HM6100 A, STDDBF.COD100 B
      WHERE
             RSMYER=${FYY}-2
         AND RSCBSD||RSCBSQ =#{JOCODE}
         AND A.RSCBSD||A.RSCBSQ =B.CBSIDO||DIGITS(B.CBSEQN)
      GROUP BY RSMYER, RSMMON, CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR=CHAR(INT('${FYY}'-2)) 
      GROUP BY RSMYER, CBCNM1
      
      UNION ALL
--조회년도 -3
   SELECT
         9 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , HKMYER||'년' AS HKMYER
          ,'경과분담금' AS TITLE
         ,SUM(HIKKM0) AS HIKKM0 
         ,SUM(HIKKM1) AS HIKKM1
         ,SUM(HIKKM2) AS HIKKM2
         ,SUM(HIKKM3) AS HIKKM3
         ,SUM(HIKKM4) AS HIKKM4
         ,SUM(HIKKM5) AS HIKKM5
         ,SUM(HIKKM6) AS HIKKM6
         ,SUM(HIKKM7) AS HIKKM7
         ,SUM(HIKKM8) AS HIKKM8
         ,SUM(HIKKM9) AS HIKKM9
         ,SUM(HIKKM10) AS HIKKM10
         ,SUM(HIKKM11) AS HIKKM11
         ,SUM(HIKKM12) AS HIKKM12
      FROM (
         SELECT
              DIGITS(HKMYER) AS HKMYER
            , DIGITS(HKMMON) AS HKMMON
            , TRIM(B.CBCNM1) AS CBCNM1
            , SUM(HKGKM) AS HIKKM0
            , CASE WHEN HKMMON=1 THEN SUM(HKGKM) ELSE 0 END AS HIKKM1
            , CASE WHEN HKMMON=2 THEN SUM(HKGKM) ELSE 0 END AS HIKKM2
            , CASE WHEN HKMMON=3 THEN SUM(HKGKM) ELSE 0 END AS HIKKM3
            , CASE WHEN HKMMON=4 THEN SUM(HKGKM) ELSE 0 END AS HIKKM4
            , CASE WHEN HKMMON=5 THEN SUM(HKGKM) ELSE 0 END AS HIKKM5
            , CASE WHEN HKMMON=6 THEN SUM(HKGKM) ELSE 0 END AS HIKKM6
            , CASE WHEN HKMMON=7 THEN SUM(HKGKM) ELSE 0 END AS HIKKM7
            , CASE WHEN HKMMON=8 THEN SUM(HKGKM) ELSE 0 END AS HIKKM8
            , CASE WHEN HKMMON=9 THEN SUM(HKGKM) ELSE 0 END AS HIKKM9
            , CASE WHEN HKMMON=10 THEN SUM(HKGKM) ELSE 0 END AS HIKKM10
            , CASE WHEN HKMMON=11 THEN SUM(HKGKM) ELSE 0 END AS HIKKM11
            , CASE WHEN HKMMON=12 THEN SUM(HKGKM) ELSE 0 END AS HIKKM12
         FROM MAADBF.HM5100 A, STDDBF.COD100 B
         WHERE
                HKMYER=${FYY}-3
            AND HKCBSD||HKCBSQ =#{JOCODE}
            AND A.HKCBSD=B.CBSIDO AND A.HKCBSQ=DIGITS(B.CBSEQN) 
            AND HKDMGB NOT IN ('6','7')
         GROUP BY HKMYER, HKMMON , CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR=CHAR(INT('${FYY}'-3)) 
      GROUP BY HKMYER, A.CBCNM1


      UNION ALL
      --조합원별 손해금액
      SELECT
         10 AS SORT1
         ,FLOAT(COALESCE(MAX(G.SON3),0))+FLOAT(COALESCE(MAX(G.SON1),0)) AS SON1
         ,FLOAT(COALESCE(MAX(G.SON1),0)) AS SON2
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS JSON1
         ,FLOAT(COALESCE(MAX(G.SON3),0)) AS SSON
         ,0 AS JSON2
         , RSMYER||'년' AS RSMYER
         , '손해금액' AS TITLE
         ,SUM(RSOKKM0)-SUM(RSIWKM)+SUM(RSMGKM) AS RSOKKM0 --당월결정금액-전월미결추산(1월마감의 전월미결추산)+차기미결추산(12월의 차기미결추산)
         ,SUM(RSOKKM1) AS RSOKKM1
         ,SUM(RSOKKM2) AS RSOKKM2
         ,SUM(RSOKKM3) AS RSOKKM3
         ,SUM(RSOKKM4) AS RSOKKM4
         ,SUM(RSOKKM5) AS RSOKKM5
         ,SUM(RSOKKM6) AS RSOKKM6
         ,SUM(RSOKKM7) AS RSOKKM7
         ,SUM(RSOKKM8) AS RSOKKM8
         ,SUM(RSOKKM9) AS RSOKKM9
         ,SUM(RSOKKM10) AS RSOKKM10
         ,SUM(RSOKKM11) AS RSOKKM11
         ,SUM(RSOKKM12) AS RSOKKM12
      FROM (
         SELECT
           DIGITS(RSMYER) AS RSMYER
         , DIGITS(RSMMON) AS RSMMON
         , TRIM(B.CBCNM1) AS CBCNM1
         , SUM(RSOKKM) AS RSOKKM0 
         , CASE WHEN RSMMON=1  THEN SUM(RSIWKM) ELSE 0 END AS RSIWKM --1월의 전월미결추산
         , CASE WHEN RSMMON=12 THEN SUM(RSMGKM) ELSE 0 END AS RSMGKM --12월의 차기미결추산
         , CASE WHEN RSMMON=1 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM1
         , CASE WHEN RSMMON=2 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM2
         , CASE WHEN RSMMON=3 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM3
         , CASE WHEN RSMMON=4 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM4
         , CASE WHEN RSMMON=5 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM5
         , CASE WHEN RSMMON=6 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM6
         , CASE WHEN RSMMON=7 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM7
         , CASE WHEN RSMMON=8 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM8
         , CASE WHEN RSMMON=9 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM9
         , CASE WHEN RSMMON=10 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM10
         , CASE WHEN RSMMON=11 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM11
         , CASE WHEN RSMMON=12 THEN SUM(RSOKKM)-SUM(RSIWKM)+SUM(RSMGKM) ELSE 0 END AS RSOKKM12

      FROM MAADBF.HM6100 A, STDDBF.COD100 B
      WHERE
             RSMYER=${FYY}-3
         AND RSCBSD||RSCBSQ =#{JOCODE}
         AND A.RSCBSD||A.RSCBSQ =B.CBSIDO||DIGITS(B.CBSEQN)
      GROUP BY RSMYER, RSMMON, CBCNM1
      ) A
      LEFT OUTER JOIN( SELECT  MYEAR,SON3, SON1 FROM CPSDBF.MAGAMSON    
     ) G ON G.MYEAR=CHAR(INT('${FYY}'-3))
      GROUP BY RSMYER, CBCNM1

      ORDER BY 1
	</select>


	<select id="tot02List" parameterType="java.util.Map"
		resultType="Map">
		SELECT
		0 AS SORT
		, C89CNT
		, CACODE AS CBCOD
		, TTTIT0 AS CBCODN
		, '' AS DAM
		, TTTIT1 AS DAMN
		,'' AS MTJONG
		, TTTIT2 AS MTJONGN
		, TTDAS1 AS MTADA1
		, TTSK11 AS MTDKM
		, TTSK14 AS HKGKM
		, 0 AS TILS
		, TTSAG1 AS SCNT
		, TTSGS1 AS C89G21
		, TTBGS1 AS C89G22
		, TTTGS1 AS C89G23
		, TTBPR1 AS SAGO_UL
		, TTGK11 AS RPOKKM
		, TTGK12 AS JKUM
		, TTGK13 AS CKUM
		,TTGK14 AS SONKUM
		, TTSPR1 AS SON_UL
		FROM CPSDBF.CP8900HOME
		WHERE
		C89YYY||C89MMM =#{TYM}
		AND CACODE =#{JIBU}
		UNION ALL
		SELECT
		1 AS ASORT
		,SORT
		,CBSEQN AS CBCOD <!-- 조합원코드 -->
		,CBCNM1 AS CBCODN<!-- 조합원명 -->
		,DAM    <!-- 담보코드 -->
		,DAMN   <!-- 담보명 -->
		,MTJONG <!-- 차종코드 -->
		,MTJONGN <!-- 차종명 -->
		,MTADA1  <!-- 평균유효대수 -->
		,MTDKM   <!-- 수입분담금 -->
		,HKGKM   <!-- 경과분담금 -->
		,TILS    <!-- 조회 기간일수 : (종료일-시작일)+1 -->

		,COALESCE(G4.SCNT,0) AS SCNT <!--사고건수 -->
		,COALESCE(G4.C89G21,0) AS C89G21 <!--발생건수 -->
		,COALESCE(G4.C89G22,0) AS C89G22 <!--사망건수 -->
		,COALESCE(G4.C89G23,0) AS C89G23 <!--부상건수 -->

		, CASE WHEN COALESCE(G4.SCNT,0)!=0
		AND COALESCE(G.TILS,0)!=0
		AND
		INT(COALESCE(G.MTADA1,0))!=0
		THEN
		(
		( FLOAT(COALESCE(G4.SCNT,0))
		/
		FLOAT(COALESCE(G.TILS,0))
		)
		* 365 / FLOAT(INT(COALESCE(G.MTADA1,0)))
		) *
		100
		ELSE 0
		END AS SAGO_UL <!-- 사고율 = [{사고건수/(기간일수)} * 365/평균요휴대수-]*100 -->
		,COALESCE(G1.RPOKKM,0) AS RPOKKM <!--지급금액 -->
		,COALESCE(G2.JKUM,0) AS JKUM <!--전기이월 미결추산 -->
		,COALESCE(G3.CKUM,0) AS CKUM <!--차기 미결추산 -->
		,COALESCE(G1.RPOKKM,0)+COALESCE(G3.CKUM,0)-COALESCE(G2.JKUM,0) AS
		SONKUM <!--손해금액(결정금액+차기이월추산-전기이월추산) -->
		,CASE WHEN
		FLOAT(COALESCE(G1.RPOKKM,0)+COALESCE(G3.CKUM,0)-COALESCE(G2.JKUM,0))>0
		AND FLOAT(G.HKGKM) > 0
		THEN
		DECIMAL((FLOAT(COALESCE(G1.RPOKKM,0)+COALESCE(G3.CKUM,0)-COALESCE(G2.JKUM,0))/FLOAT(G.HKGKM))*100,10,2)
		ELSE 0
		END AS SON_UL <!--손해율 -->
		FROM (
		<!--대인 차종별 -->
		SELECT
		1 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'1' AS DAM
		,'대인' AS DAMN
		,B.MTJONG AS MTJONG
		,TRIM(C.CJNAM1) AS
		MTJONGN
		,MAX(COALESCE(G1.MTADA1,0)) AS MTADA1
		,SUM(MTGKM1)+SUM(MTGKM2)
		AS HKGKM
		,SUM(MTDKM1)+SUM(MTDKM2) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD030 C, STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		, MTJONG
		, SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		,
		SUM(MTADA3) AS MTADA3
		, SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG, INT(MTADA1) AS MTADA1, INT(MTADA2) AS
		MTADA2,
		INT(MTADA3) AS MTADA3, INT(MTADA4) AS MTADA4, INT(MTADA5) AS
		MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) =
		'${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD, MTJONG
		) G1 ON
		B.CBCOD=G1.CBCOD AND B.MTJONG=G1.MTJONG
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'
		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))
		AND B.MTJONG=C.CJCODE
		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1, B.MTJONG,C.CJNAM1
		UNION ALL

		<!--대인 소계 -->
		SELECT
		2 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'1' AS DAM
		,'대인' AS DAMN
		,'99' AS MTJONG
		,'소계' AS MTJONGN
		,MAX(COALESCE(G1.MTADA1,0)) AS MTADA1
		,SUM(MTGKM1)+SUM(MTGKM2) AS HKGKM
		,SUM(MTDKM1)+SUM(MTDKM2) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS
		FROM
		STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		,
		SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		, SUM(MTADA3) AS MTADA3
		,
		SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG,
		INT(MTADA1) AS MTADA1, INT(MTADA2) AS MTADA2,
		INT(MTADA3) AS MTADA3,
		INT(MTADA4) AS MTADA4, INT(MTADA5) AS MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) = '${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD
		) G1 ON B.CBCOD=G1.CBCOD
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'
		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))
		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1
		<!--자손 차종 -->
		UNION ALL
		SELECT
		3 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS CBCNM1
		,'3' AS DAM
		,'자손' AS DAMN
		,B.MTJONG AS MTJONG
		,TRIM(C.CJNAM1) AS MTJONGN
		,MAX(COALESCE(G1.MTADA4,0)) AS MTADA1
		,SUM(MTGKM4) AS HKGKM
		,SUM(MTDKM4) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD030 C, STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		, MTJONG
		, SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		,
		SUM(MTADA3) AS MTADA3
		, SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG, INT(MTADA1) AS MTADA1, INT(MTADA2) AS
		MTADA2,
		INT(MTADA3) AS MTADA3, INT(MTADA4) AS MTADA4, INT(MTADA5) AS
		MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) =
		'${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD, MTJONG
		) G1 ON
		B.CBCOD=G1.CBCOD AND B.MTJONG=G1.MTJONG

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))
		AND B.MTJONG=C.CJCODE

		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1, B.MTJONG,C.CJNAM1

		UNION ALL
		<!--자손 소계 -->
		SELECT
		4 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'3' AS DAM
		,'자손' AS DAMN
		,'99' AS MTJONG
		,'소계' AS MTJONGN
		,MAX(COALESCE(G1.MTADA4,0)) AS MTADA1
		,SUM(MTGKM4) AS HKGKM
		,SUM(MTDKM4) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		,
		SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		, SUM(MTADA3) AS MTADA3
		,
		SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG,
		INT(MTADA1) AS MTADA1, INT(MTADA2) AS MTADA2,
		INT(MTADA3) AS MTADA3,
		INT(MTADA4) AS MTADA4, INT(MTADA5) AS MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) = '${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD
		) G1 ON B.CBCOD=G1.CBCOD

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM)    <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))


		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1

		UNION ALL
		<!--대물 차종 -->

		SELECT
		5 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'2' AS DAM
		,'대물' AS DAMN
		,B.MTJONG AS MTJONG
		,TRIM(C.CJNAM1) AS
		MTJONGN
		,MAX(COALESCE(G1.MTADA3,0)) AS MTADA1
		,SUM(MTGKM3) AS HKGKM
		,SUM(MTDKM3) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD030 C, STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		, MTJONG
		, SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		,
		SUM(MTADA3) AS MTADA3
		, SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG, INT(MTADA1) AS MTADA1, INT(MTADA2) AS
		MTADA2,
		INT(MTADA3) AS MTADA3, INT(MTADA4) AS MTADA4, INT(MTADA5) AS
		MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) =
		'${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD, MTJONG
		) G1 ON
		B.CBCOD=G1.CBCOD AND B.MTJONG=G1.MTJONG

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))
		AND B.MTJONG=C.CJCODE

		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1, B.MTJONG,C.CJNAM1

		UNION ALL
		<!--자손 소계 -->
		SELECT
		6 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'2' AS DAM
		,'대물' AS DAMN
		,'99' AS MTJONG
		,'소계' AS MTJONGN
		,MAX(COALESCE(G1.MTADA3,0)) AS MTADA1
		,SUM(MTGKM3) AS HKGKM
		,SUM(MTDKM3) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		,
		SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		, SUM(MTADA3) AS MTADA3
		,
		SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG,
		INT(MTADA1) AS MTADA1, INT(MTADA2) AS MTADA2,
		INT(MTADA3) AS MTADA3,
		INT(MTADA4) AS MTADA4, INT(MTADA5) AS MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) = '${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD
		) G1 ON B.CBCOD=G1.CBCOD

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))


		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1


		UNION ALL
		<!--자차 차종 -->

		SELECT
		7 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'4' AS DAM
		,'차량' AS DAMN
		,B.MTJONG AS MTJONG
		,TRIM(C.CJNAM1) AS
		MTJONGN
		,MAX(COALESCE(G1.MTADA5,0)) AS MTADA1
		,SUM(MTGKM5) AS HKGKM
		,SUM(MTDKM5) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD030 C, STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		, MTJONG
		, SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		,
		SUM(MTADA3) AS MTADA3
		, SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG, INT(MTADA1) AS MTADA1, INT(MTADA2) AS
		MTADA2,
		INT(MTADA3) AS MTADA3, INT(MTADA4) AS MTADA4, INT(MTADA5) AS
		MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) =
		'${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD, MTJONG
		) G1 ON
		B.CBCOD=G1.CBCOD AND B.MTJONG=G1.MTJONG

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))
		AND B.MTJONG=C.CJCODE

		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1, B.MTJONG,C.CJNAM1

		UNION ALL

		<!--자차 소계 -->
		SELECT
		8 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'4' AS DAM
		,'차량' AS DAMN
		,'99' AS MTJONG
		,'소계' AS MTJONGN
		,MAX(COALESCE(G1.MTADA5,0)) AS MTADA1
		,SUM(MTGKM5) AS HKGKM
		,SUM(MTDKM5) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		,
		SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		, SUM(MTADA3) AS MTADA3
		,
		SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG,
		INT(MTADA1) AS MTADA1, INT(MTADA2) AS MTADA2,
		INT(MTADA3) AS MTADA3,
		INT(MTADA4) AS MTADA4, INT(MTADA5) AS MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) = '${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD
		) G1 ON B.CBCOD=G1.CBCOD

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))


		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1


		UNION ALL
		<!--합계 차종 -->

		SELECT
		9 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1) AS
		CBCNM1
		,'9' AS DAM
		,'합계' AS DAMN
		,B.MTJONG AS MTJONG
		,TRIM(C.CJNAM1) AS
		MTJONGN
		,0 AS MTADA1
		,SUM(MTGKM1)+SUM(MTGKM2)+SUM(MTGKM3)+SUM(MTGKM4)+SUM(MTGKM5) AS HKGKM
		,SUM(MTDKM1)+SUM(MTDKM2)+SUM(MTDKM3)+SUM(MTDKM4)+SUM(MTDKM5) AS MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD030 C, STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		, MTJONG
		, SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		,
		SUM(MTADA3) AS MTADA3
		, SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG, INT(MTADA1) AS MTADA1, INT(MTADA2) AS
		MTADA2,
		INT(MTADA3) AS MTADA3, INT(MTADA4) AS MTADA4, INT(MTADA5) AS
		MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) =
		'${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD, MTJONG
		) G1 ON
		B.CBCOD=G1.CBCOD AND B.MTJONG=G1.MTJONG

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))
		AND B.MTJONG=C.CJCODE

		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1, B.MTJONG,C.CJNAM1

		UNION ALL
		<!--합계 소계 -->
		SELECT
		10 AS SORT
		,A.CBSIDO||DIGITS(A.CBSEQN) AS CBSEQN
		,TRIM(A.CBCNM1)
		AS CBCNM1
		,'9' AS DAM
		,'합계' AS DAMN
		,'99' AS MTJONG
		,'소계' AS MTJONGN
		,0 AS
		MTADA1
		,SUM(MTGKM1)+SUM(MTGKM2)+SUM(MTGKM3)+SUM(MTGKM4)+SUM(MTGKM5) AS
		HKGKM
		,SUM(MTDKM1)+SUM(MTDKM2)+SUM(MTDKM3)+SUM(MTDKM4)+SUM(MTDKM5) AS
		MTDKM
		,DAYS(LAST_DAY(DATE(TIMESTAMP_FORMAT('${TYM}01','YYYY-MM-DD'))))
		-DAYS(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD')))+1 AS TILS

		FROM
		STDDBF.COD100 A, MAADBF.MAG200C B
		LEFT OUTER JOIN(
		SELECT
		CBCOD
		,
		SUM(MTADA1) AS MTADA1
		, SUM(MTADA2) AS MTADA2
		, SUM(MTADA3) AS MTADA3
		,
		SUM(MTADA4) AS MTADA4
		, SUM(MTADA5) AS MTADA5
		FROM
		(SELECT CBCOD, MTJONG,
		INT(MTADA1) AS MTADA1, INT(MTADA2) AS MTADA2,
		INT(MTADA3) AS MTADA3,
		INT(MTADA4) AS MTADA4, INT(MTADA5) AS MTADA5
		FROM MAADBF.MAG200C
		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) = '${TYM}'
		AND CBCOD='${JOCODE}'
		) A
		GROUP BY CBCOD
		) G1 ON B.CBCOD=G1.CBCOD

		WHERE
		DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(MTSTYY)||DIGITS(MTSTMM) <![CDATA[<=]]>
		'${TYM}'

		AND A.CBSIDO=SUBSTR(B.CBCOD,1,2) AND
		A.CBSEQN=INT(SUBSTR(B.CBCOD,3,4))


		AND
		A.CBSIDO||DIGITS(A.CBSEQN)='${JOCODE}'
		GROUP BY A.CBSIDO, A.CBSEQN,
		A.CBCNM1
		ORDER BY 1,3,5
		) G

		<!--결정공제금 -->
		LEFT OUTER JOIN(
		SELECT B.C2CACOD AS RPCBSQ
		,C89GUBN  <!--담보 -->
		,C2MJONG
		,SUM(C89K72) AS RPOKKM
		FROM CPSDBF.CP8900 A, CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[<=]]>
		'${TYM}'
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH =B.C2BUNH
		AND
		B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C89GUBN,C2MJONG

		UNION ALL
		SELECT B.C2CACOD AS RPCBSQ
		,C89GUBN  <!--담보 -->
		,'99' AS C2MJONG
		,SUM(C89K72) AS RPOKKM
		FROM CPSDBF.CP8900 A,
		CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[<=]]>
		'${TYM}'
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH =B.C2BUNH
		AND
		B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C89GUBN

		UNION ALL
		<!--합계 차종 -->
		SELECT B.C2CACOD AS RPCBSQ
		,'9' AS C89GUBN  <!--담보 -->
		,C2MJONG
		,SUM(C89K72) AS RPOKKM
		FROM CPSDBF.CP8900 A, CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[<=]]>
		'${TYM}'
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH =B.C2BUNH
		AND
		B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C2MJONG
		UNION ALL
		SELECT
		B.C2CACOD AS RPCBSQ
		,'9' AS C89GUBN  <!--담보 -->
		,'99' AS C2MJONG
		,SUM(C89K72) AS RPOKKM
		FROM CPSDBF.CP8900 A,
		CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[>=]]>
		'${FYM}'
		AND DIGITS(C89YYY)||DIGITS(C89MMM)  <![CDATA[<=]]>
		'${TYM}'
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH =B.C2BUNH
		AND
		B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD


		) G1 ON G.CBSEQN=G1.RPCBSQ AND
		G.DAM=G1.C89GUBN AND G.MTJONG=G1.C2MJONG

		<!--전기이월 미결추산 -->
		LEFT OUTER JOIN(
		<!--담보, 차종 소계 -->
		SELECT B.C2CACOD AS RPCBSQ
		,C89GUBN  <!--담보 -->
		,C2MJONG
		,SUM(C89K81) AS JKUM
		FROM CPSDBF.CP8900 A, CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) =
		SUBSTR(REPLACE(CHAR(DATE(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD'))-
		1 DAYS ),ISO),'-',''),1,6)
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH
		=B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C89GUBN,C2MJONG

		UNION ALL
		<!--담보, 소계 -->
		SELECT B.C2CACOD AS RPCBSQ
		,C89GUBN  <!--담보 -->
		,'99' AS C2MJONG
		,SUM(C89K81) AS JKUM
		FROM CPSDBF.CP8900 A,
		CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) =
		SUBSTR(REPLACE(CHAR(DATE(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD'))-
		1 DAYS ),ISO),'-',''),1,6)
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH
		=B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C89GUBN

		UNION ALL
		<!--합계, 차종 소계 -->
		SELECT B.C2CACOD AS RPCBSQ
		,'9' AS C89GUBN  <!--담보 -->
		,C2MJONG
		,SUM(C89K81) AS JKUM
		FROM CPSDBF.CP8900 A, CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) =
		SUBSTR(REPLACE(CHAR(DATE(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD'))-
		1 DAYS ),ISO),'-',''),1,6)
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH
		=B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C2MJONG
		UNION ALL
		<!--합계, 소계 -->
		SELECT B.C2CACOD AS RPCBSQ
		,'9' AS C89GUBN  <!--담보 -->
		,'99' AS C2MJONG
		,SUM(C89K81) AS JKUM
		FROM CPSDBF.CP8900 A,
		CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) =
		SUBSTR(REPLACE(CHAR(DATE(DATE(TIMESTAMP_FORMAT('${FYM}01','YYYY-MM-DD'))-
		1 DAYS ),ISO),'-',''),1,6)
		AND A.C89YEAR =B.C2YEAR AND A.C89BUNH
		=B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD


		) G2 ON
		G.CBSEQN=G2.RPCBSQ AND G.DAM=G2.C89GUBN AND G.MTJONG=G2.C2MJONG

		<!--차기 미결추산 -->
		LEFT OUTER JOIN(
		<!--담보, 차종 -->
		SELECT B.C2CACOD AS RPCBSQ
		,C89GUBN  <!--담보 -->
		,C2MJONG
		,SUM(C89K81) AS CKUM
		FROM CPSDBF.CP8900 A, CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) ='${TYM}'
		AND A.C89YEAR =B.C2YEAR
		AND A.C89BUNH =B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD,
		C89GUBN,C2MJONG

		UNION ALL
		<!--담보, 소계 -->
		SELECT B.C2CACOD AS RPCBSQ
		,C89GUBN  <!--담보 -->
		,'99' AS C2MJONG
		,SUM(C89K81) AS CKUM
		FROM CPSDBF.CP8900 A,
		CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) ='${TYM}'
		AND
		A.C89YEAR =B.C2YEAR AND A.C89BUNH =B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD, C89GUBN
		UNION ALL
		<!--합계 , 차종 -->
		SELECT B.C2CACOD AS RPCBSQ
		,'9' AS C89GUBN  <!--담보 -->
		,C2MJONG
		,SUM(C89K81) AS CKUM
		FROM CPSDBF.CP8900 A, CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) ='${TYM}'
		AND A.C89YEAR =B.C2YEAR
		AND A.C89BUNH =B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD,
		C2MJONG
		UNION ALL
		<!--합계 , 소계 -->
		SELECT B.C2CACOD AS RPCBSQ
		,'9' AS C89GUBN  <!--담보 -->
		,'99' AS C2MJONG
		,SUM(C89K81) AS CKUM
		FROM CPSDBF.CP8900 A,
		CPSDBF.CP2200 B
		WHERE
		DIGITS(C89YYY)||DIGITS(C89MMM) ='${TYM}'
		AND
		A.C89YEAR =B.C2YEAR AND A.C89BUNH =B.C2BUNH
		AND B.C2CACOD='${JOCODE}'
		GROUP BY B.C2CACOD
		) G3 ON G.CBSEQN=G3.RPCBSQ AND G.DAM=G3.C89GUBN AND
		G.MTJONG=G3.C2MJONG

		<!--사고건수, 사망 , 부상, 인원계 -->
		LEFT OUTER JOIN(
		<!--담보, 차종, 사고건수 -->
		SELECT
		C2CACOD
		,C89GUBN
		,C2MJONG
		,COUNT(*) AS SCNT         <!--사고건수 -->
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,SUM(C89G22) AS C89G22
		,SUM(C89G23) AS C89G23
		FROM (
		SELECT
		A.C2CACOD AS
		C2CACOD
		,B.C89GUBN AS C89GUBN
		,A.C2MJONG AS C2MJONG
		,A.C2YEAR AS C2YEAR
		,A.C2BUNH AS C2BUNH
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN 0 ELSE SUM(C89G22) END AS
		C89G22 <!--발생사망 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN SUM(C89G22) ELSE SUM(C89G23)
		END AS C89G23 <!--발생부상 -->
		FROM CPSDBF.CP2200 A, CPSDBF.CP8900 B
		WHERE
		A.C2YEAR=B.C89YEAR AND
		A.C2BUNH=B.C89BUNH
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[>=]]>'${FYM}'
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[<=]]>'${TYM}'
		AND C89G21!=0
		AND A.C2CACOD='${JOCODE}'

		GROUP BY A.C2CACOD, B.C89GUBN
		,A.C2YEAR ,A.C2BUNH, A.C2MJONG

		) G

		GROUP BY C2CACOD, C89GUBN, C2MJONG

		UNION ALL

		<!--담보, 소계 -->
		SELECT
		C2CACOD
		,C89GUBN
		,'99' AS C2MJONG
		,COUNT(*) AS SCNT         <!--사고건수 -->
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,SUM(C89G22) AS C89G22  <!--발생사망 -->
		,SUM(C89G23) AS C89G23     <!--발생부상 -->

		FROM (
		SELECT
		A.C2CACOD AS C2CACOD
		,B.C89GUBN AS C89GUBN
		,A.C2MJONG AS
		C2MJONG
		,A.C2YEAR AS C2YEAR
		,A.C2BUNH AS C2BUNH
		,SUM(C89G21) AS C89G21 <!--발생건수 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN 0 ELSE SUM(C89G22) END AS
		C89G22 <!--발생사망 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN SUM(C89G22) ELSE SUM(C89G23)
		END AS C89G23 <!--발생부상 -->
		FROM CPSDBF.CP2200 A, CPSDBF.CP8900 B
		WHERE
		A.C2YEAR=B.C89YEAR AND
		A.C2BUNH=B.C89BUNH
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[>=]]>'${FYM}'
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[<=]]>'${TYM}'
		AND C89G21!=0
		AND A.C2CACOD='${JOCODE}'

		GROUP BY A.C2CACOD, B.C89GUBN
		,A.C2YEAR ,A.C2BUNH, A.C2MJONG

		) G

		GROUP BY C2CACOD, C89GUBN


		UNION ALL

		<!--합계, 차종, 소계 -->
		SELECT
		C2CACOD
		,'9' AS C89GUBN
		,C2MJONG
		,COUNT(*) AS SCNT         <!--사고건수 -->
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,SUM(C89G22) AS C89G22  <!--발생사망 -->
		,SUM(C89G23) AS C89G23     <!--발생부상 -->

		FROM (
		SELECT
		A.C2CACOD AS C2CACOD
		,B.C89GUBN AS C89GUBN
		,A.C2MJONG AS
		C2MJONG
		,A.C2YEAR AS C2YEAR
		,A.C2BUNH AS C2BUNH
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN 0 ELSE SUM(C89G22) END AS
		C89G22 <!--발생사망 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN SUM(C89G22) ELSE SUM(C89G23)
		END AS C89G23 <!--발생부상 -->

		FROM CPSDBF.CP2200 A, CPSDBF.CP8900 B
		WHERE
		A.C2YEAR=B.C89YEAR AND
		A.C2BUNH=B.C89BUNH
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[>=]]>'${FYM}'
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[<=]]>'${TYM}'
		AND C89G21!=0
		AND A.C2CACOD='${JOCODE}'

		GROUP BY A.C2CACOD, B.C89GUBN
		,A.C2YEAR ,A.C2BUNH, A.C2MJONG

		) G

		GROUP BY C2CACOD,C2MJONG

		UNION ALL

		<!--합계, 소계 -->
		SELECT
		C2CACOD
		,'9' AS C89GUBN
		,'99' AS C2MJONG
		,COUNT(*) AS SCNT         <!--사고건수 -->
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,SUM(C89G22) AS C89G22  <!--발생사망 -->
		,SUM(C89G23) AS C89G23     <!--발생부상 -->

		FROM (
		SELECT
		A.C2CACOD AS C2CACOD
		,B.C89GUBN AS C89GUBN
		,A.C2MJONG AS
		C2MJONG
		,A.C2YEAR AS C2YEAR
		,A.C2BUNH AS C2BUNH
		,SUM(C89G21) AS C89G21  <!--발생건수 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN 0 ELSE SUM(C89G22) END AS
		C89G22 <!--발생사망 -->
		,CASE WHEN B.C89GUBN IN ('2','4') THEN SUM(C89G22) ELSE SUM(C89G23)
		END AS C89G23 <!--발생부상 -->

		FROM CPSDBF.CP2200 A, CPSDBF.CP8900 B
		WHERE
		A.C2YEAR=B.C89YEAR AND
		A.C2BUNH=B.C89BUNH
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[>=]]>'${FYM}'
		AND DIGITS(B.C89YYY)||DIGITS(C89MMM) <![CDATA[<=]]>'${TYM}'
		AND C89G21!=0
		AND A.C2CACOD='${JOCODE}'

		GROUP BY A.C2CACOD, B.C89GUBN
		,A.C2YEAR ,A.C2BUNH, A.C2MJONG

		) G

		GROUP BY C2CACOD

		ORDER BY 1,2,3
		) G4 ON
		G.CBSEQN=G4.C2CACOD AND G.DAM=G4.C89GUBN AND
		G.MTJONG=G4.C2MJONG

		ORDER BY 1 DESC ,2, 3

	</select>

	<select id="tot03List" parameterType="java.util.Map"
		resultType="Map">
		SELECT A.C2YEAR||'-'||A.C2BUNH AS C2BUNH /* 사고번호 */
		,
		A.C2SYMD||A.C2SHHH||A.C2SMMM
		AS C2SYMD/* 사고일자 */
		, A.C2SHHH||':'||A.C2SMMM AS C2STIME /* 사고시간 */
		,
		SUBSTR(A.C2JYMD,1,4)||'-'||SUBSTR(A.C2JYMD,5,2)||'-'||SUBSTR(A.C2JYMD,7,2)
		AS C2JYMD1 /* 접수일자 */
		, C2JYMD||A.C2JHHH||A.C2JMMM AS C2JYMD /* 접수시간 */
		,
		CASE WHEN A.C2SCHNO!='' THEN TRIM(A.C2SCHNO) ELSE A.C2SCDAE END AS C2SCHNO
		/* 차량번호 */
		, TRIM(A.C2DNAM) AS C2DNAM /* 운전자 명 */
		, COALESCE(G1.KUM,0) +
		COALESCE(G2.KUM,0) + COALESCE(G3.KUM,0) + COALESCE(G4.KUM,0) AS KUM9
		,
		COALESCE(O1.OKUM,0) AS OKUM
		, COALESCE(G1.CNT,0)
		AS CNT1 /* 대인인원 */
		,
		COALESCE(G1.KUM,0) AS KUM1 /* 대인추산 */
		, COALESCE(G2.CNT,0) AS CNT2 /*
		대물건수 */
		, COALESCE(G2.KUM,0) AS KUM2 /*
		대물추산 */
		, COALESCE(G3.CNT,0) AS
		CNT3 /* 자손인원 */
		, COALESCE(G3.KUM,0) AS
		KUM3 /* 자손추산 */
		,
		COALESCE(G4.CNT,0) AS CNT4 /* 자차건수 */
		, COALESCE(G4.KUM,0) AS KUM4 /*
		자차추산 */
		,CASE WHEN C2MYGUN='1' THEN '일보전면책'
    		 WHEN C2MYGUN='2' THEN '이보전면책'
    		 WHEN C2MYGUN='3' THEN '종결후면책'
    		 WHEN C2STAT='1' THEN '접수'    
     		 WHEN C2STAT='2' THEN '일보'                     
    		 WHEN C2STAT='3' THEN '종결'    
                             ELSE ''
	    	 END AS C2STAT
		FROM CPSDBF.CP2200 A
		LEFT OUTER
		JOIN (SELECT A.C2YEAR,A.C2BUNH,SUM(A.C42OKKU9) AS OKUM
		FROM
		CPSDBF.CP4200 A WHERE A.C42OYMD!=''
		GROUP BY
		A.C2YEAR,A.C2BUNH
		) O1 ON
		O1.C2YEAR=A.C2YEAR AND O1.C2BUNH=A.C2BUNH

		LEFT OUTER
		JOIN (SELECT A.C2YEAR,A.C2BUNH,COUNT(*) AS CNT,SUM(A.C22CSTOT)
		AS KUM
		FROM CPSDBF.CP2220 A WHERE A.C22MYYMD='' AND A.C2GUBN='1'
		GROUP
		BY
		A.C2YEAR,A.C2BUNH
		) G1 ON G1.C2YEAR=A.C2YEAR AND G1.C2BUNH=A.C2BUNH
		LEFT OUTER JOIN (SELECT A.C2YEAR,A.C2BUNH,COUNT(*) AS CNT
		,SUM(A.C22CSTOT)
		AS KUM
		FROM CPSDBF.CP2220 A WHERE A.C22MYYMD='' AND
		A.C2GUBN='2'
		GROUP BY A.C2YEAR,A.C2BUNH
		) G2 ON G2.C2YEAR=A.C2YEAR AND
		G2.C2BUNH=A.C2BUNH
		LEFT OUTER JOIN (SELECT A.C2YEAR,A.C2BUNH,COUNT(*)
		AS CNT ,SUM(A.C22CSTOT)
		AS KUM
		FROM CPSDBF.CP2220 A WHERE A.C22MYYMD=''
		AND A.C2GUBN='3'
		GROUP BY A.C2YEAR,A.C2BUNH
		) G3 ON G3.C2YEAR=A.C2YEAR
		AND G3.C2BUNH=A.C2BUNH
		LEFT OUTER JOIN (SELECT
		A.C2YEAR,A.C2BUNH,COUNT(*) AS CNT ,SUM(A.C22CSTOT)
		AS KUM
		FROM
		CPSDBF.CP2220 A WHERE A.C22MYYMD='' AND A.C2GUBN='4'
		GROUP BY
		A.C2YEAR,A.C2BUNH
		) G4 ON G4.C2YEAR=A.C2YEAR AND G4.C2BUNH=A.C2BUNH
		WHERE SUBSTR(A.C2SYMD, 1, 6) = #{FYM}
		AND A.C2CACOD = #{JOCODE}
		ORDER BY
		C2SYMD DESC
		/* 조회시점에 따라 추산액 ,
		피해 인원 이나 피해건수가 변동될수 있습니다. */
	</select>

	<select id="tot04List" parameterType="java.util.Map"
		resultType="Map">
		SELECT
		TRIM(C2DNAM) AS C2DNAM, <!-- 조합원명 -->
		SUBSTR(TRIM(DAMO.SCP_DECB64('SCPKID13',A.C2DJUNO)), 1, 6) AS C2DJUNO,<!-- 운전자주민번호 -->
		A.C2CACOD AS C2CACOD, <!-- 조합원코드 -->
		SUBSTR(A.C2CACOD,1,2)|| '-' || SUBSTR(A.C2CACOD,3,4)|| '' ||TRIM(A.C2CNAME) AS C2CNAME, <!-- 조합명 -->
		A.C2YEAR ||'-'|| A.C2BUNH AS C2BUN, <!-- 사고번호 -->
		A.C2SYMD || A.C2SHHH || A.C2SMMM AS C2SYMD, <!-- 사고일시 -->
		A.C2JYMD || A.C2JHHH || A.C2JMMM AS C2JYMD, <!-- 접수일시 -->
		COALESCE(G5.CP13NAME,'') AS CP13NAME, <!-- 사고원인 -->
		TRIM(A.C2SCHNO) AS C2SCHNO, <!-- 차량번호 -->
		COALESCE(G3.C42OKKU9,0) AS C42OKKU9 <!-- 지급액 -->
		,CASE WHEN A.C2STAT = '1' THEN '접수상태'
		WHEN A.C2STAT = '2' THEN '일보상태'
		WHEN A.C2STAT = '3' AND A.C2MYGUN = '1' THEN '일보전면책'
		WHEN A.C2STAT = '3' AND A.C2MYGUN = '2' THEN '이보전면책'
		WHEN A.C2STAT = '3' AND A.C2MYGUN = '3' THEN '종결후면책'
		WHEN A.C2STAT = '3' AND A.C2MYYMD ='' THEN '완전종결'
		ELSE '' END AS C2STATNA
		FROM CPSDBF.CP2200 A <!-- CP2200FILE : 사고접수파일 --> <!-- CP4200 보상결정품의서 결정금액 -->
		LEFT OUTER JOIN(SELECT C2YEAR,C2BUNH, SUM(C42OKKU9) AS C42OKKU9
		FROM
		CPSDBF.CP4200
		WHERE C42AGUBN='2' <!-- 승인 -->
		AND C42OYMD != ''
		AND C2GUBN='1'
		OR C2GUBN='2' <!-- 대인,대물건 합계 -->
		GROUP BY C2YEAR,
		C2BUNH)G3
		ON A.C2YEAR = G3.C2YEAR
		AND A.C2BUNH =
		G3.C2BUNH
		LEFT OUTER JOIN(SELECT CP13CODE,
		TRIM(CP13NAME) AS CP13NAME
		FROM CPSDBF.CP13)G5
		ON A.C2KSCO1 = G5.CP13CODE
		LEFT OUTER JOIN(SELECT
		CBSIDO,
		CBSEQN,
		TRIM(CBPOS1)
		||TRIM(CBPOS2) AS CPOST,
		TRIM(CBJUSO) AS
		CJUSO
		FROM STDDBF.COD100 ) G6
		ON G6.CBSIDO=SUBSTR(A.C2CACOD,1,2)
		AND
		DIGITS(G6.CBSEQN) = SUBSTR(A.C2CACOD,3,4)
		
		<!--
		LEFT OUTER JOIN(SELECT
		C2YEAR,
		C2BUNH,
		COUNT(*) AS CNT1
		FROM CPSDBF.CP2220
		WHERE INT(C22CFIL)>=21
		AND C2GUBN='1'
		GROUP BY C2YEAR,
		C2BUNH ) G7
		ON G7.C2YEAR = A.C2YEAR
		AND
		G7.C2BUNH=A.C2BUNH -->
		
		
		WHERE A.C2DJUNO != ''
		AND SUBSTR(C2SYMD, 1, 4)=#{FYM}
		AND
		A.C2CACOD=#{JOCODE}
		AND A.C2MYGUN=''
		ORDER BY C2SYMD DESC
	</select>

	<select id="tot05List" parameterType="java.util.Map"
		resultType="Map">
		SELECT
		DIGITS(A.MKYEAR)||'-'||DIGITS(A.MKBUNH) AS MKBUN  <!-- 계약번호 -->
		, MKCBSD||'-'||DIGITS(MKCBSQ) AS CBCOD <!-- 조합원코드 -->
		, TRIM(A.MKNAME) AS MKNAME <!-- 조합원명 -->
		, CASE WHEN TRIM(A.MKCHNO)!='' THEN TRIM(A.MKCHNO) ELSE TRIM(A.MKCDAE)
		END AS MKCHNO  <!-- 차량번호 -->
		, DIGITS(MKTYY1)||DIGITS(MKTMM1)||DIGITS(MKTDD1) AS MKTYMD1  <!-- 만기일자 -->
		, A.MKSHTR AS MKSHTR <!--전계약적용율 -->
		, COALESCE(G1.HBGUNS,'') AS HBGUNS <!-- 사고건수 -->
		, COALESCE(G1.HBJUMS,'') AS HBJUMS <!-- 사고점수 -->

		, CASE WHEN COALESCE(G2.SPBYMD,'') !='' THEN COALESCE(G2.MKSHHR,0)
		ELSE COALESCE(G1.HBNHHR,'') END AS HBNHHR <!-- 표준요율 -->
		, CASE WHEN COALESCE(G2.SPBYMD,'') !='' THEN COALESCE(G2.MKSHBR,0)
		ELSE COALESCE(G1.HBNHBR,'') END AS HBNHBR <!-- 범위요율 -->
		, CASE WHEN COALESCE(G2.SPBYMD,'') !='' THEN COALESCE(G2.MKSPHR,0)
		ELSE COALESCE(G1.HBNHSR,'') END AS HBNHSR <!-- 특별요율 -->
		, CASE WHEN COALESCE(G2.SPBYMD,'') !='' THEN COALESCE(G2.MKSHTR,0)
		ELSE COALESCE(G1.HBNHTR,'') END AS HBNHTR <!-- 적용율계 -->
		, CASE WHEN COALESCE(G2.SPBYMD,'') !='' THEN '갱신완료' ELSE '' END AS
		CHK1
		, COALESCE(G2.SPBYMD,'') AS SPBYMD <!-- 영수일자 -->
		, A.MKJJCD AS MKJJCD
		, TRIM(B.CASIDO) AS MKJJCDN <!-- 관리지부 -->
		FROM
		NEWSTD.COD020 B
		,MAADBF.MM3500 A
		LEFT OUTER JOIN(
		SELECT
		HBYEAR,
		HBBUNH
		,DIGITS(HBFYMD) AS HBFYMD <!-- 평가기간 -->
		,DIGITS(HBTYMD) AS HBTYMD <!-- 평가기간 -->
		,HBGUNS AS HBGUNS <!-- 사고건수 -->
		,HBJUMS AS HBJUMS <!-- 사고점수 -->
		,HBNHHR AS HBNHHR <!-- 표준요율 -->
		,HBNHBR AS HBNHBR <!-- 범위요율 -->
		,HBNHSR AS HBNHSR <!-- 특별요율 -->
		,HBNHTR AS HBNHTR <!-- 적용율계 -->

		FROM MAADBF.HM1200
		) G1 ON A.MKYEAR=G1.HBYEAR AND A.MKBUNH=G1.HBBUNH
		LEFT OUTER JOIN(
		SELECT
		MKOYER, MKOBUN, DIGITS(SPBYMD) AS SPBYMD
		,MKSHHR
		,MKSHBR
		,MKSPHR
		,MKSHTR
		FROM MAADBF.MM3500 A, MAADBF.SP1100 B
		WHERE
		A.MKYEAR=B.SPYEAR AND A.MKBUNH=B.SPBUNH
		AND
		DIGITS(MKFYY1)||DIGITS(MKFMM1)||DIGITS(MKFDD1) !=
		DIGITS(MKTYY1)||DIGITS(MKTMM1)||DIGITS(MKTDD1)

		) G2 ON
		A.MKYEAR=G2.MKOYER AND A.MKBUNH=G2.MKOBUN
		WHERE
		A.MKJJCD=B.CACODE
		AND
		MKCBSD||DIGITS(MKCBSQ)=#{JOCODE}
		AND
		DIGITS(MKFYY1)||DIGITS(MKFMM1)||DIGITS(MKFDD1) !=
		DIGITS(MKTYY1)||DIGITS(MKTMM1)||DIGITS(MKTDD1)
		AND
		DIGITS(MKTYY1)||DIGITS(MKTMM1)||DIGITS(MKTDD1) <![CDATA[>=]]>
		#{FYM}
		AND DIGITS(MKTYY1)||DIGITS(MKTMM1)||DIGITS(MKTDD1) <![CDATA[<=]]>
		#{TYM}

		ORDER BY MKTYY1 DESC, MKTMM1 DESC, MKTDD1 DESC
	</select>

	<select id="tot06List" parameterType="java.util.Map"
		resultType="Map">
		SELECT
		TRIM(D.MKCBSD)||DIGITS(D.MKCBSQ) AS CBCOD
		, TRIM(C2DNAM) AS C2DNAM
		, TRIM(MKNAME) AS MKNAME
		, CASE WHEN TRIM(MKCHNO)='' THEN TRIM(MKCDAE)
		ELSE TRIM(MKCHNO)
		END AS MKCHNO
		, DIGITS(MKYEAR)||'-'||DIGITS(MKBUNH) AS MKBUNH
		, A.C2YEAR||'-'||A.C2BUNH AS C2BUNH
		, B.C2SYMD AS C2SYMD
		, A.C2JYMD AS C2JYMD
		, CASE WHEN A.JACHK='1' OR A.JACHK='4' THEN '수납'
		WHEN A.JACHK='' THEN '미납'
		WHEN A.JACHK='9' THEN '미대상'
		END AS JACHK
		, CASE WHEN JACHK='9' THEN 0 ELSE JABKUM END AS JABKUM
		, CASE WHEN JACHK='1' THEN JAIKUM1
		WHEN JAYYMD!='' THEN JABKUM
		WHEN JACHK='4' THEN JABKUM
		ELSE 0
		END AS JAIKUM1
		, CASE WHEN JAYYMD!='' THEN
		SUBSTR(JAYYMD,1,4)||'/'||SUBSTR(JAYYMD,5,2)||'/'||SUBSTR(JAYYMD,7,2)
		WHEN JAIPYMD1!='' THEN
		SUBSTR(JAIPYMD1,1,4)||'/'||SUBSTR(JAIPYMD1,5,2)||'/'||SUBSTR(JAIPYMD1,7,2)
		ELSE ''
		END AS JAIPYMD1
		, CASE WHEN C.C22STAT='1' THEN '접수'
		WHEN C.C22STAT='2' THEN '일보'
		WHEN C.C22STAT='3' AND C22MYGUN='1' THEN '일보전면책'
		WHEN C.C22STAT='3' AND C22MYGUN='2' THEN '이보전면책'
		WHEN C.C22STAT='3' AND C22MYGUN='3' THEN '종결후면책'
		WHEN C.C22STAT='3' THEN '종결' ELSE ''
		END AS C22SATAT
		, TRIM(B.C2DNAM)AS C2DNAM		
		, A.C22CDSAN AS C22CDSAN
		, TRIM(A.C22CDSANA) AS C22CDSANA
		, A.C22CDCOD AS C22CDCOD
		, TRIM(E.CASIDO) AS C22CDCODN
		, JAHKUM
		, CASE WHEN A.JAHYMD='' THEN ''
		ELSE SUBSTR(JAHYMD,1,4)||'/'||SUBSTR(JAHYMD,5,2)||'/'||SUBSTR(JAHYMD,7,2)
		END AS JAHYMD

		FROM CPSDBF.JA1000 A
		, CPSDBF.CP2200 B
		, CPSDBF.CP2220 C
		, MAADBF.MM3500 D
		, NEWSTD.COD020 E

		WHERE
		A.C2CACOD= #{JOCODE}
		
		AND A.C2YEAR=B.C2YEAR
		AND A.C2BUNH=B.C2BUNH
		AND A.C2MYEAR=DIGITS(D.MKYEAR)
		AND A.C2MBUNH=DIGITS(D.MKBUNH)
		AND C.C2YEAR=A.C2YEAR
		AND C.C2BUNH=A.C2BUNH
		AND C.C2GUBN='2'
		AND C.C22SEQN=A.C22SEQN
		AND A.C22CDCOD=E.CACODE

		<if test=' GUBN2 == "1" '> <!-- 수납 -->
			AND (A.JACHK='1' OR A.JACHK='4')
			AND SUBSTR(B.C2SYMD,1,6) = #{FYM}
		</if>
		<if test=' GUBN2 == "2" '> <!-- 미납(전체기간조회) -->
			AND A.JACHK=''
		</if>
		<if test=' GUBN2 == "3" '> <!-- 삭제 -->
			AND A.JACHK='9'
			AND SUBSTR(B.C2SYMD,1,6) = #{FYM}
		</if>
		ORDER BY 1,2,3,4

	</select>




	<select id="tot07List" parameterType="java.util.Map"
		resultType="Map">
		SELECT
			DIGITS(A.YYM2)||'-'||DIGITS(A.MMM2)||'-'||DIGITS(A.DDM2) AS YMD
			, CASE WHEN A.ACCD='2410800' THEN '환급금'
				   WHEN A.ACCD='2410500' THEN '분담금'
			ELSE '기타환급' END AS ACCDNA
			, A.BKCD
			, TRIM(COALESCE(B.MGCDT,'')) AS BKCDNA
			,SUBSTR(TRIM(DAMO.SCP_DECB64('SCPKALL',COALESCE(TRIM(A.ACNO), ''))),1,6)||'********' AS ACNO
			, A.CMNA
			, A.MVKM
			, SNAME AS COMNA
		FROM CMSTCPIP.CMSOUTF C, ACTDBF.AM8100 A
		LEFT OUTER JOIN (
			SELECT
				A.MJCD,A.YYMK,A.MMMK,A.DDMK,A.NOSQ,A.DSEQ
				,TRIM(DAMO.SCP_DECB64('SCPKALL',COALESCE(TRIM(A.PSN1), '' ))) AS PSN1
			FROM ACTDBF.AM2100 A
		WHERE
		MSTAT='2'
		AND
		TRIM(DAMO.SCP_DECB64('SCPKALL',COALESCE(TRIM(A.PSN1), ''
		)))=#{JOCODE}
		) G ON G.MJCD=A.MJCD AND G.YYMK=A.YYMK AND G.MMMK=A.MMMK AND
		G.DDMK=A.DDMK
		AND G.NOSQ=A.NOSQ AND G.DSEQ=A.DSEQ
		, ACTDBF.AM1120YY B
		WHERE
		DIGITS(A.YYM2)||DIGITS(A.MMM2) = #{FYM}
		AND PSOK='Y' AND
		(ACCD='2410500' OR ACCD='2410800')
		AND COALESCE(G.PSN1,'')!=''
		AND
		B.YY=DIGITS(A.YYM2) AND B.IDCD='09' AND B.MGCD=A.BKCD
		AND
		A.MJCD||DIGITS(A.YYMK)||DIGITS(A.MMMK)||DIGITS(A.DDMK)||DIGITS(A.NOSQ)||DIGITS(A.DSEQ)
		=C.STSNO
		AND C.TRNCD = '0000'
		ORDER BY YMD DESC
	</select>

	<select id="tot08List" parameterType="java.util.Map"
		resultType="Map">
		SELECT MKJJCD , COALESCE(G.CASIDO,'-') AS CASIDO 
		, A.MKCBSD||DIGITS(A.MKCBSQ) AS CBCOD 
		, DIGITS(MKYEAR)||'-'||DIGITS(MKBUNH) AS MKBUNH 
		, TRIM(MKNAME) AS MKNAME
		, TRIM(A.MKCHNO) AS MKCHNO 
		, TRIM(MKCDAE) AS MKCDAE , TRIM(G2.CJNAM1) AS MKJONG 
		, CASE WHEN MKDGUB='1' THEN '개별' WHEN MKDGUB='2' THEN '단체'
		WHEN MKDGUB='3' THEN '단개' END AS MKDGUB 
		, DIGITS(MKYEAR)||'-'||DIGITS(MKBUNH) AS MKBUNH 
		, DIGITS(MKFYY0)||DIGITS(MKFMM0)||DIGITS(MKFDD0)||DIGITS(MKTYY0)||DIGITS(MKTMM0)||DIGITS(MKTDD0) AS MKFTYMD 
		, MKSHHR 
		, MKSHBR 
		, MKSPHR 
		, MKSHTR 
		, MKJKM1 
		, MKJKM2 +	MKJKM3 + MKJKM4 + MKJKM5 AS XKJKM2 
		, MKJKM1 + MKJKM2 + MKJKM3 + MKJKM4	+ MKJKM5 AS L2TKUM 
		, COALESCE(G1.CHK,'ERR') AS CHK
		, TRIM(MKSAP1)||'-'||TRIM(MKSAP2)||'-'||TRIM(DAMO.SCP_DECB64('SCPKALL',MKSAP3))
		AS MKSAP , DIGITS(MKYRCD) AS MKYRCD 
		FROM MAADBF.MM3500 A LEFT OUTER
		JOIN(SELECT TRIM(CASIDO) AS CASIDO, CACODE FROM NEWSTD.COD020 )G ON
		A.MKJJCD=CACODE LEFT OUTER JOIN(SELECT MKYEAR AS MMYEAR, MKBUNH AS
		MMBUNH, CASE WHEN MKSTAT = '9' THEN CASE WHEN DIGITS(MK3DAY) >
		#{FYM} THEN 'OK' ELSE 'ERR' END WHEN MKSTAT <![CDATA[<>]]> '9' THEN CASE WHEN
		DIGITS(MKTYY0)||DIGITS(MKTMM0)||DIGITS(MKTDD0) >= #{FYM} THEN 'OK'
		ELSE 'ERR' END END AS CHK FROM MAADBF.MM3500 WHERE
		DIGITS(MKFYY0)||DIGITS(MKFMM0)||DIGITS(MKFDD0) <![CDATA[<]]> #{FYM} AND
		MKCBSD||DIGITS(MKCBSQ) = #{JOCODE} )G1 ON A.MKYEAR=G1.MMYEAR AND
		A.MKBUNH=G1.MMBUNH LEFT OUTER JOIN ( SELECT TRIM(CJCODE) AS CJCODE,
		TRIM(CJNAM1) AS CJNAM1 FROM STDDBF.COD030 ) G2 ON A.MKJONG = G2.CJCODE
		WHERE DIGITS(MKFYY0)||DIGITS(MKFMM0)||DIGITS(MKFDD0) <![CDATA[<]]> #{FYM} AND
		COALESCE(G1.CHK,'ERR')='OK' AND A.MKCBSD||DIGITS(A.MKCBSQ) = #{JOCODE}
		ORDER BY MKJJCD, A.MKCBSD, A.MKCBSQ , A.MKCHNO
	</select>

	<select id="selectJibuInfo" parameterType="String" resultType="Map">
	SELECT CBFLD1
			, TRIM(B.CASIDO) AS CASIDO
			, CBSIDO
			, CBSEQN
			, CBCNM1
			, CBCNM2
			, CBCHK3
			, CBSAU1 || '-' || CBSAU2 || '-' || TRIM(DAMO.SCP_DECB64('SCPKALL',CBSAU3)) AS CBSAU
	 FROM STDDBF.COD100 A
	 INNER JOIN NEWSTD.COD020 B
	  ON A.CBFLD1 = B.CACODE	 
	WHERE CBSIDO || DIGITS(CBSEQN) = #{jocode}
	</select>
	
	
	<update id="countHomeLogCnt">
		MERGE INTO
		MAADBF.HOMELOG A
		USING
		SYSIBM.SYSDUMMY1 ON A.IYMD =VARCHAR_FORMAT(CURRENT TIMESTAMP,'YYYYMMDD') AND CACOD =
		#{CACOD} AND HTMLID = #{HTMLID}
		WHEN MATCHED THEN
		UPDATE SET
		IYMD = #{IYMD}
		, CACOD = #{CACOD}
		, CANAME = #{CANAME}
		, HTMLID = #{HTMLID}
		, HTMNAME = #{HTMNAME}
		, CNT = CNT + 1
		WHEN NOT MATCHED THEN
		INSERT (
		IYMD
		, CACOD
		, CANAME
		, HTMLID
		, HTMNAME
		, CNT
		) VALUES (
		#{IYMD}
		, #{CACOD}
		, #{CANAME}
		, #{HTMLID}
		, #{HTMNAME}
		, #{CNT}
		)
	</update>
</mapper>


	